import{r as u,X as de,c as F,d as T,j as e,G as s,R as x,U as v,g as P,z as R,H as Y,J as B,K as k,N as a,Q as M,T as i}from"./index-CxJtQRLb.js";import{h as U}from"./moment-G82_0lEo.js";import{l as oe}from"./Krishna Industries2-CaiO6x1k.js";import{D as ae,a as ie,b as le}from"./DialogContent-DOuEahYY.js";const he=({cust_id:S,onClose:W})=>{const[j,K]=u.useState([]),[q,L]=u.useState([]),H=de(),[n,O]=u.useState({cust_id:S||"",payment_type:"",payment_amount:"",balance:"",total:"",dispatchdate:""}),[c,C]=u.useState({pro_id:"",quantity:"",price:""}),[p,V]=u.useState([]),[l,w]=u.useState({}),[z,E]=u.useState(!1),[A,J]=u.useState("");u.useEffect(()=>{F.get(`${T.apiUrl}/product/getProductData`).then(t=>{K(t.data)}).catch(t=>{console.log("Product data is not fetched.")})},[]),u.useEffect(()=>{F.get(`${T.apiUrl}/customer/getCustomerByEmpId/${sessionStorage.getItem("emp_id")}`).then(t=>{L(t.data)}).catch(t=>{console.log("Customer data is not fetched.")})},[]),u.useEffect(()=>{J(X())},[]);const X=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let r="";for(let o=0;o<8;o++)r+=t.charAt(Math.floor(Math.random()*t.length));return r},I=(t,r)=>{let o="";const d=r&&typeof r=="string"?r.trim():r;switch(t){case"pro_id":d||(o="Product name is required.");break;case"quantity":d||(o="Quantity is required.");break;case"price":d||(o="Price is required.");break;case"payment_type":d||(o="Payment type is required.");break;case"payment_amount":d||(o="Payment amount is required.");break;case"balance":d||(o="Balance amount is required.");break;case"total":d||(o="Total amount is required.");break}return o},y=t=>{const{name:r,value:o}=t.target;let d={...n,[r]:o};if(r==="payment_type"&&o==="partial"){const h=parseFloat(d.total||0),g=parseFloat(d.payment_amount||0);d.balance=(h-g).toFixed(2)}else if(r==="payment_amount"){const h=parseFloat(d.total||0),g=parseFloat(o||0);d.balance=(h-g).toFixed(2)}else if(r==="quantity"||r==="price"){const h=parseFloat(d.quantity||0),g=parseFloat(d.price||0);d.total=(h*g).toFixed(2)}const f=I(r,o);O(d),w({...l,[r]:f})},Z=()=>{let t={};if(Object.keys(c).forEach(r=>{const o=c[r],d=I(r,o);d&&(t[r]=d)}),Object.keys(t).length>0){w(t);return}V([...p,c]),C({pro_id:"",quantity:"",price:""}),w({})},ee=async t=>{if(t.preventDefault(),p.length===0){alert("Please add at least one product.");return}const r=p.reduce((m,G)=>m+parseFloat(G.price)*parseFloat(G.quantity),0),o=parseFloat(n.payment_amount||0),d=(r-o).toFixed(2),f=p.map(m=>m.pro_id),h=p.map(m=>m.quantity),g=p.map(m=>m.price),re={...n,pro_id:f,quantity:h,price:g,total:r.toFixed(2),balance:d};try{await F.post(`${T.apiUrl}/cust_purch/addCustPurch`,re),E(!0)}catch(m){console.error("Error:",m),alert("Failed to submit the form.")}},te=async()=>{const t={to:b.cust_email,subject:"Invoice",html:`
            <div style="font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9;">
                <!-- Header Section -->
                <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #004d40; padding-bottom: 10px;">
                    <img src="https://krishnaindustries.bewelldentalandaestheticcare.in/assets/Krishna%20Industries-d-0GPqQG.jpeg" alt="Company Logo" width="75px" height="50px" />
                    <div style="text-align: center;">
                        <h4 style="font-weight: bold; color: #004d40; margin: 0;">Quotation</h4>
                        <h6>Date: ${U().format("YYYY-MM-DD")}</h6>
                        <h6>Invoice No: ${A}</h6>
                    </div>
                </div>
                <!-- Client and Company Info -->
                <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                    <div style="border-right: 2px solid #004d40; padding-right: 20px;">
                        <h6 style="font-weight: bold; color: #004d40;">From:</h6>
                        <p>Krishna Industries</p>
                        <p>Peelamedu, Singanallur</p>
                        <p>Coimbatore, 627757</p>
                        <p>Phone: +91-1234567890</p>
                        <p>Email: <span style="color: #004d40;">info@krishnaindustries.com</span></p>
                    </div>
                    <div style="padding-left: 20px;">
                        <h6 style="font-weight: bold; color: #004d40;">To:</h6>
                        <p>${b.cust_name}</p>
                        <p>Phone: ${b.cust_phone}</p>
                        <p>Email: ${b.cust_email}</p>
                    </div>
                </div>
                <!-- Itemized Table -->
                <div style="margin-top: 20px; border: 1px solid #004d40; border-radius: 4px; overflow: hidden; background-color: #ffffff;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #004d40; color: #ffffff;">
                                <th style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">S.No</th>
                                <th style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Product Name</th>
                                <th style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Description</th>
                                <th style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Quantity</th>
                                <th style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Price</th>
                                <th style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${p.map((r,o)=>{var d,f;return`
                                <tr key=${o}>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${o+1}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${(d=j.find(h=>h.pro_id===r.pro_id))==null?void 0:d.pro_name}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${(f=j.find(h=>h.pro_id===r.pro_id))==null?void 0:f.description}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${r.quantity}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${parseFloat(r.price).toFixed(2)}</td>
                                    <td style="border: 1px solid #ddd; padding: 8px;">${(parseFloat(r.price)*parseFloat(r.quantity)).toFixed(2)}</td>
                                </tr>
                            `}).join("")}
                        </tbody>
                    </table>
                </div>
                <!-- Summary and Footer -->
                <div style="margin-top: 20px; text-align: right; border-top: 2px solid #004d40; padding-top: 10px;">
                    <h6 style="color: #004d40;"><span style="font-weight: bold;">Subtotal:</span> ${_.toFixed(2)}</h6>
                    <h6 style="color: #004d40;"><span style="font-weight: bold;">CGST 9%:</span> ${D}</h6>
                    <h6 style="color: #004d40;"><span style="font-weight: bold;">SGST 9%:</span> ${$}</h6>
                    <h6 style="color: #004d40;"><span style="font-weight: bold;">Total Amount:</span> ${Q}</h6>
                </div>
                <!-- Payment Terms -->
                <div style="margin-top: 20px; border-top: 2px solid #004d40; padding-top: 10px;">
                    <h6 style="margin-top: 20px; text-align: center; font-style: italic; color: #004d40;">Thank you for your business!</h6>
                </div>
            </div>
        `};try{await F.post(`${T.apiUrl}/send-email`,t),alert("Email sent successfully"),N(),W()}catch(r){console.error("Error sending email:",r),alert("Error sending email")}},N=()=>{E(!1),W(),H("/CustPurchIndex")},b=q.find(t=>t.cust_id===n.cust_id)||{};parseFloat(c.price||0),parseFloat(c.quantity||0);const _=p.reduce((t,r)=>t+parseFloat(r.price)*parseFloat(r.quantity),0),D=(_*.09).toFixed(2),$=(_*.09).toFixed(2),Q=(_+parseFloat(D)+parseFloat($)).toFixed(2);return e.jsxs("div",{children:[e.jsx("h1",{className:"text-center",children:"Purchase Form"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:6,children:S?e.jsx(x,{select:!0,fullWidth:!0,name:"cust_id",label:"Select customer",onChange:y,value:n.cust_id,disabled:!0,children:q.map(t=>e.jsx(v,{value:t.cust_id,children:t.cust_name},t.cust_id))}):e.jsx(x,{select:!0,fullWidth:!0,name:"cust_id",label:"Select customer",onChange:y,value:n.cust_id,error:!!l.cust_id,helperText:l.cust_id,children:q.map(t=>e.jsx(v,{value:t.cust_id,children:t.cust_name},t.cust_id))})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{select:!0,fullWidth:!0,name:"pro_id",label:"Select Product Name",onChange:t=>C({...c,pro_id:t.target.value}),value:c.pro_id,error:!!l.pro_id,helperText:l.pro_id,children:j.map(t=>e.jsx(v,{value:t.pro_id,children:t.pro_name},t.pro_id))})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,name:"quantity",label:"Quantity",type:"number",onChange:t=>C({...c,quantity:t.target.value}),value:c.quantity,error:!!l.quantity,helperText:l.quantity})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,name:"price",label:"Price",type:"number",onChange:t=>C({...c,price:t.target.value}),value:c.price,error:!!l.price,helperText:l.price})}),e.jsx(s,{item:!0,xs:12,display:"flex",justifyContent:"center",children:e.jsx(P,{onClick:Z,children:"Add Product"})}),p.length>0&&e.jsx(s,{item:!0,xs:12,children:e.jsx(R,{style:{marginTop:"20px",border:"1px solid #004d40",borderRadius:"4px",overflow:"hidden",backgroundColor:"#ffffff"},children:e.jsxs(Y,{children:[e.jsx(B,{children:e.jsxs(k,{children:[e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"S.No"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Product Name"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Quantity"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Price"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Total"})]})}),e.jsx(M,{children:p.map((t,r)=>{var o;return e.jsxs(k,{children:[e.jsx(a,{style:{border:"1px solid #ddd"},children:r+1}),e.jsx(a,{style:{border:"1px solid #ddd"},children:(o=j.find(d=>d.pro_id===t.pro_id))==null?void 0:o.pro_name}),e.jsx(a,{style:{border:"1px solid #ddd"},children:t.quantity}),e.jsx(a,{style:{border:"1px solid #ddd"},children:parseFloat(t.price).toFixed(2)}),e.jsx(a,{style:{border:"1px solid #ddd"},children:(parseFloat(t.price)*parseFloat(t.quantity)).toFixed(2)})]},r)})})]})})}),e.jsx(s,{item:!0,xs:6,children:e.jsxs(x,{select:!0,fullWidth:!0,name:"payment_type",label:"Select Payment type",onChange:y,value:n.payment_type,error:!!l.payment_type,helperText:l.payment_type,children:[e.jsx(v,{value:"full",children:"Full Payment"}),e.jsx(v,{value:"partial",children:"Partial Payment"})]})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,name:"total",label:"Total",type:"number",onChange:y,value:_,disabled:!0})}),n.payment_type==="partial"&&e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,name:"payment_amount",label:"Advance Amount",type:"number",onChange:y,value:n.payment_amount,error:!!l.payment_amount,helperText:l.payment_amount})}),n.payment_type==="full"&&e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,name:"payment_amount",label:"Payment Amount",type:"number",onChange:y,value:n.payment_amount,error:!!l.payment_amount,helperText:l.payment_amount})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,name:"balance",label:"Balance Amount",type:"number",onChange:y,value:n.balance,error:!!l.balance,helperText:l.balance,disabled:!0})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(x,{fullWidth:!0,name:"dispatchdate",label:"Dispatch Date",type:"date",onChange:y,value:n.dispatchdate,error:!!l.dispatchdate,helperText:l.dispatchdate,InputLabelProps:{shrink:!0}})}),e.jsx(s,{item:!0,xs:12,display:"flex",justifyContent:"center",children:e.jsx(P,{onClick:ee,children:"Submit"})})]}),e.jsxs(ae,{open:z,onClose:W,maxWidth:"lg",children:[e.jsx(ie,{children:e.jsxs("div",{style:{fontFamily:"Arial, sans-serif",maxWidth:"800px",margin:"auto",padding:"20px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"#f9f9f9"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"3px solid #004d40",paddingBottom:"10px"},children:[e.jsx("img",{src:oe,alt:"Company Logo",width:"150",height:"auto"}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(i,{variant:"h4",style:{fontWeight:"bold",color:"#004d40"},children:"Invoice"}),e.jsxs(i,{variant:"h6",children:["Invoice No: ",A]}),e.jsxs(i,{variant:"h6",children:["Date: ",U().format("YYYY-MM-DD")]})]})]}),e.jsxs(s,{container:!0,spacing:3,style:{marginTop:"20px"},children:[e.jsxs(s,{item:!0,xs:6,style:{borderRight:"2px solid #004d40",paddingRight:"20px"},children:[e.jsx(i,{variant:"h6",style:{fontWeight:"bold",color:"#004d40"},children:"From:"}),e.jsx(i,{children:"Krishna Industries"}),e.jsx(i,{children:"Peelamedu, Singanallur"}),e.jsx(i,{children:"Coimbatore, 627757"}),e.jsx(i,{children:"Phone: +91-1234567890"}),e.jsxs(i,{children:["Email:",e.jsx("span",{style:{color:"#004d40"},children:"info@krishnaindustries.com"})]})]}),e.jsxs(s,{item:!0,xs:6,style:{paddingLeft:"20px"},children:[e.jsx(i,{variant:"h6",style:{fontWeight:"bold",color:"#004d40"},children:"To:"}),e.jsx(i,{children:b.cust_name}),e.jsxs(i,{children:["Phone:  ",b.cust_phone]}),e.jsxs(i,{children:["Email: ",b.cust_email]})]})]}),e.jsx(R,{style:{marginTop:"20px",border:"1px solid #004d40",borderRadius:"4px",overflow:"hidden",backgroundColor:"#ffffff"},children:e.jsxs(Y,{children:[e.jsx(B,{children:e.jsxs(k,{children:[e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"S.No"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Product Name"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Description"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Quantity"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Price"}),e.jsx(a,{style:{border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#004d40",color:"#ffffff"},children:"Total"})]})}),e.jsx(M,{children:p.map((t,r)=>{var o,d;return e.jsxs(k,{children:[e.jsx(a,{style:{border:"1px solid #ddd"},children:r+1}),e.jsx(a,{style:{border:"1px solid #ddd"},children:(o=j.find(f=>f.pro_id===t.pro_id))==null?void 0:o.pro_name}),e.jsx(a,{style:{border:"1px solid #ddd"},children:(d=j.find(f=>f.pro_id===t.pro_id))==null?void 0:d.description}),e.jsx(a,{style:{border:"1px solid #ddd"},children:t.quantity}),e.jsx(a,{style:{border:"1px solid #ddd"},children:parseFloat(t.price).toFixed(2)}),e.jsx(a,{style:{border:"1px solid #ddd"},children:(parseFloat(t.price)*parseFloat(t.quantity)).toFixed(2)})]},r)})})]})}),e.jsxs("div",{style:{marginTop:"20px",borderTop:"2px solid #004d40",paddingTop:"10px",textAlign:"right"},children:[e.jsxs(i,{variant:"h6",style:{color:"#004d40"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Subtotal:"})," ",_.toFixed(2)]}),e.jsxs(i,{variant:"h6",style:{color:"#004d40"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"CGST 9%:"})," ",D]}),e.jsxs(i,{variant:"h6",style:{color:"#004d40"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"SGST 9%:"})," ",$]}),e.jsxs(i,{variant:"h6",style:{color:"#004d40"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Total Amount:"})," ",Q]})]}),e.jsxs("div",{style:{marginTop:"20px",borderTop:"2px solid #004d40",paddingTop:"10px"},children:[e.jsx(i,{variant:"h6",style:{fontWeight:"bold",color:"#004d40"},children:"Payment Terms:"}),e.jsx(i,{children:"..."})]}),e.jsx(i,{variant:"h6",style:{marginTop:"20px",textAlign:"center",fontStyle:"italic",color:"#004d40"},children:"Thank you for your business!"})]})}),e.jsxs(le,{children:[e.jsx(P,{onClick:N,children:"Close"}),e.jsx(P,{color:"primary",onClick:te,children:"Send to Email"})]})]})]})};export{he as A};
