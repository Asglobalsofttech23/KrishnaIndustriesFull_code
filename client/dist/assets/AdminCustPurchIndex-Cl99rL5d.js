import{r,c as F,d as T,j as e,G as u,R as j,U as f,g as x,F as le,V as ie,z as ce,E as oe,H as de,J as ue,K as Q,N as d,Q as he,S as pe}from"./index-CxJtQRLb.js";import{S as me}from"./Search-BCnfRBZA.js";import{A as xe}from"./AdminAddCustPurch-DpqvBGV8.js";import{P as je}from"./AdminPurchaseInvoice-Bz-mYJ0p.js";import{D as fe}from"./DateFilter-BhaPmPsL.js";import{P as ge}from"./Pagination-CQtFweVv.js";import{D as E,a as N,b as R}from"./DialogContent-DOuEahYY.js";import{D as W}from"./DialogTitle-Cl70ZkoL.js";import{f as ye}from"./format-cwXK75ha.js";import"./moment-G82_0lEo.js";const De=({data:a,onClose:q})=>{const[A,P]=r.useState([]),[v,I]=r.useState([]),[i,_]=r.useState({cust_id:a?a.cust_id:"",pro_id:a?a.pro_id:"",quantity:a?a.quantity:"",price:a?a.price:"",payment_type:a?a.payment_type:"",advance:a?a.advance:"",balance:a?a.balance:"",total:a?a.total:""}),[s,b]=r.useState({cust_id:"",pro_id:"",quantity:"",price:"",payment_type:"",advance:"",balance:"",total:""});r.useEffect(()=>{F.get(`${T.apiUrl}/product/getProductData`).then(n=>{P(n.data)}).catch(n=>{console.log("Customer purchase data is not fetched.")})},[]),r.useEffect(()=>{F.get(`${T.apiUrl}/customer/getCustomerForAdmin`).then(n=>{I(n.data)}).catch(n=>{console.log("Customer data is not fetched.")})},[]);const U=(n,l)=>{l&&typeof l=="string"&&l.trim()},m=n=>{const{name:l,value:o}=n.target;let h={...i,[l]:o};if(l==="payment_type"&&o==="partial"){const g=parseFloat(h.total||0),y=parseFloat(h.advance||0);h.balance=(g-y).toFixed(2)}else if(l==="advance"){const g=parseFloat(h.total||0),y=parseFloat(o||0);h.balance=(g-y).toFixed(2)}else if(l==="quantity"||l==="price"){const g=parseFloat(h.quantity||0),y=parseFloat(h.price||0);h.total=(g*y).toFixed(2)}const S=U(l,o);_(h),b({...s,[l]:S})},k=n=>{n.preventDefault();let l={};if(Object.keys(i).forEach(o=>{const h=i[o],S=U(o,h);S&&(l=S)}),Object.keys(l).length>0){b(l);return}F.put(`${T.apiUrl}/cust_purch/updateCustPurch/${a.cust_purch_id}`,i).then(o=>{q()}).catch(o=>{console.log("Error:",o)})};return e.jsx("div",{children:e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:6,children:e.jsx(j,{select:!0,fullWidth:!0,name:"cust_id",label:"Select customer",onChange:m,value:i.cust_id,error:!!s.cust_id,helperText:s.cust_id,children:v.map(n=>e.jsx(f,{value:n.cust_id,children:n.cust_name},n.cust_id))})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(j,{select:!0,fullWidth:!0,name:"pro_id",label:"Select Product Name",onChange:m,value:i.pro_id,error:!!s.pro_id,helperText:s.pro_id,children:A.map(n=>e.jsx(f,{value:n.pro_id,children:n.pro_name},n.pro_id))})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(j,{fullWidth:!0,name:"quantity",label:"Quantity",type:"number",onChange:m,value:i.quantity,error:!!s.quantity,helperText:s.quantity})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(j,{fullWidth:!0,name:"price",label:"Price",type:"number",onChange:m,value:i.price,error:!!s.price,helperText:s.price})}),e.jsx(u,{item:!0,xs:6,children:e.jsxs(j,{select:!0,fullWidth:!0,name:"payment_type",label:"Select Payment type",onChange:m,value:i.payment_type,error:!!s.payment_type,helperText:s.payment_type,children:[e.jsx(f,{value:"full",children:"Full Payment"}),e.jsx(f,{value:"partial",children:"Partial Payment"})]})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(j,{fullWidth:!0,name:"total",label:"Total",type:"number",onChange:m,value:i.total,error:!!s.total,helperText:s.total})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(j,{fullWidth:!0,name:"advance",label:"Amount",type:"number",onChange:m,value:i.advance,error:!!s.advance,helperText:s.advance})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(j,{fullWidth:!0,name:"balance",label:"Balance Amount",type:"number",onChange:m,value:i.balance,error:!!s.balance,helperText:s.balance})}),e.jsx(u,{item:!0,xs:12,display:"flex",justifyContent:"center",children:e.jsx(x,{onClick:k,children:"Submit"})})]})})},Ie=()=>{const[a,q]=r.useState([]),[A,P]=r.useState([]),[v,I]=r.useState(5),[i,_]=r.useState(1),[s,b]=r.useState(!1),[U,m]=r.useState(!1),[k,n]=r.useState(!1),[l,o]=r.useState(!1),[h,S]=r.useState([]),[g,y]=r.useState(),[w,G]=r.useState(null),[$,V]=r.useState(""),[O,J]=r.useState(""),[K,M]=r.useState(new Set);r.useEffect(()=>{F.get(`${T.apiUrl}/cust_purch/getCustPurchDataForAdmin`).then(t=>{q(t.data),P(t.data);const c=new Set(t.data.filter(p=>p.deliveryed).map(p=>p.cust_purch_id));M(c)}).catch(t=>{console.log("Customer purchase data is not fetched.")})},[s,U,k]);const L=t=>{const c=a.find(p=>p.cust_purch_id===cust_purch_id);c&&(S(c),m(!0))},X=t=>{y(t),n(!0)},Y=()=>{F.delete(`${T.apiUrl}/cust_purch/deleteCustPurch/${g}`).then(t=>{n(!1)}).catch(t=>{console.log("Error deleting data. Please try again later.")})},Z=t=>{const c=parseInt(t.target.value,10);c===1?(I(a.length),_(1)):(I(c),_(1))},ee=t=>{G(t),o(!0)},te=()=>{if($&&O){const t=a.filter(c=>{const p=new Date(c.created_at);return p>=new Date($)&&p<=new Date(O)});P(t),_(1)}else P(a)},z=(i-1)*v,ae=i*v,ne=A.slice(z,ae),re=t=>{F.post(`${T.apiUrl}/cust_purch/markAsDelivered/${t}`).then(c=>{console.log(c.data.message),M(p=>new Set(p.add(t)))}).catch(c=>{console.log("Error marking as delivered. Please try again later.")})};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-center",children:"Customer Purchase Index"}),e.jsxs(u,{container:!0,spacing:2,className:"mt-3",children:[e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(x,{onClick:()=>b(!0),variant:"contained",children:"Purchase Product"})}),e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(me,{data:a,setData:P})}),e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(le,{children:e.jsxs(ie,{value:v,onChange:Z,children:[e.jsx(f,{value:5,children:"5 Per Page"}),e.jsx(f,{value:10,children:"10 Per Page"}),e.jsx(f,{value:15,children:"15 Per Page"}),e.jsx(f,{value:1,children:"All Per Page"})]})})})]}),e.jsx(fe,{startDate:$,endDate:O,setStartDate:V,setEndDate:J,onFilter:te}),e.jsx(ce,{component:oe,className:"mt-4",children:e.jsxs(de,{children:[e.jsx(ue,{children:e.jsx(Q,{children:["S.No","Customer Name","Customer Mobile","Customer Email","Product Name","Quantity","Price","Date/Time","Payment Type","Payment Amount","Balance","Total","Action"].map(t=>e.jsx(d,{style:{fontWeight:"bold",textAlign:"center"},children:t},t))})}),e.jsx(he,{children:ne.map((t,c)=>{const p=t.product_names?t.product_names.split(","):[],B=t.quantities?t.quantities.split(","):[],H=t.prices?t.prices.split(","):[];return e.jsxs(Q,{children:[e.jsx(d,{align:"center",children:z+c+1}),e.jsx(d,{align:"center",children:t.cust_name}),e.jsx(d,{align:"center",children:t.cust_mobile}),e.jsx(d,{align:"center",children:t.cust_email}),e.jsx(d,{align:"center",children:p.length>0?p.map((D,C)=>e.jsx("div",{children:D},C)):"No products"}),e.jsx(d,{align:"center",children:B.length>0?B.map((D,C)=>e.jsx("div",{children:D},C)):"No quantities"}),e.jsx(d,{align:"center",children:H.length>0?H.map((D,C)=>e.jsx("div",{children:D},C)):"No prices"}),e.jsx(d,{children:(()=>{const D=ye(new Date(t.created_at),"dd/MM/yyyy HH:mm:ss"),[C,se]=D.split(" ");return e.jsxs(e.Fragment,{children:[C," ",e.jsx("span",{style:{color:"red"},children:se})]})})()}),e.jsx(d,{align:"center",children:t.payment_type}),e.jsx(d,{align:"center",children:t.payment_amount}),e.jsx(d,{align:"center",children:t.balance}),e.jsx(d,{align:"center",children:t.total}),e.jsxs(d,{align:"center",children:[e.jsx(x,{onClick:()=>L(t.cust_purch_id),variant:"contained",color:"primary",size:"small",style:{margin:"2px"},children:"Edit"}),e.jsx(x,{onClick:()=>X(t.cust_purch_id),variant:"contained",color:"secondary",size:"small",style:{margin:"2px"},children:"Delete"}),e.jsx(x,{onClick:()=>ee(t),variant:"contained",color:"success",size:"small",style:{margin:"2px"},children:"Invoice"}),!K.has(t.cust_purch_id)&&e.jsx(x,{onClick:()=>re(t.cust_purch_id),variant:"contained",color:"info",size:"small",style:{margin:"2px"},children:"Mark as Delivered"})]})]},t.cust_purch_id)})})]})}),e.jsx(pe,{spacing:2,className:"mt-4",direction:"row",justifyContent:"center",children:e.jsx(ge,{count:Math.ceil(A.length/v),page:i,onChange:(t,c)=>_(c),color:"primary"})}),e.jsxs(E,{open:s,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{children:"Purchase Product"}),e.jsx(N,{children:e.jsx(xe,{onClose:()=>b(!1)})})]}),e.jsxs(E,{open:U,onClose:()=>m(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{children:"Update Purchase"}),e.jsx(N,{children:e.jsx(De,{updateData:h,onClose:()=>m(!1)})})]}),e.jsxs(E,{open:k,onClose:()=>n(!1),children:[e.jsx(W,{children:"Confirm Deletion"}),e.jsx(N,{children:"Are you sure you want to delete this item?"}),e.jsxs(R,{children:[e.jsx(x,{onClick:Y,color:"primary",children:"Confirm"}),e.jsx(x,{onClick:()=>n(!1),color:"secondary",children:"Cancel"})]})]}),e.jsxs(E,{open:l,onClose:()=>o(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{children:"Purchase Invoice"}),e.jsx(N,{dividers:!0,children:w&&e.jsx(je,{data:w,dueDate:w.dueDate})}),e.jsx(R,{children:e.jsx(x,{onClick:()=>o(!1),color:"primary",children:"Close"})})]})]})};export{Ie as default};
