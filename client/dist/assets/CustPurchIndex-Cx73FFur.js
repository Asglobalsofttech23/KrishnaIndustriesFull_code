import{r as n,c as I,d as A,j as e,G as i,R as m,g as h,F as ie,V as le,U as q,z as ce,E as oe,H as de,J as ue,K as H,N as c,Q as me,S as he}from"./index-CxJtQRLb.js";import{S as xe}from"./Search-BCnfRBZA.js";import{A as pe}from"./AddCustPurch-FAcdwpbu.js";import{D as b,a as S,b as M}from"./DialogContent-DOuEahYY.js";import{D as W}from"./DialogTitle-Cl70ZkoL.js";import{P as je}from"./AdminPurchaseInvoice-Bz-mYJ0p.js";import{D as ge}from"./DateFilter-BhaPmPsL.js";import{P as fe}from"./Pagination-CQtFweVv.js";import{f as ye}from"./format-cwXK75ha.js";import"./moment-G82_0lEo.js";import"./Krishna Industries2-CaiO6x1k.js";const Ce=({updateData:a,onClose:D})=>{const[r,g]=n.useState({cust_id:"",cust_name:"",cust_mobile:"",cust_email:"",product_names:"",quantities:"",prices:"",payment_type:"",payment_amount:"",balance:"",total:""}),[P,N]=n.useState({});n.useEffect(()=>{a&&(g({cust_id:a.cust_id||"",cust_name:a.cust_name||"",cust_mobile:a.cust_mobile||"",cust_email:a.cust_email||"",product_names:Array.isArray(a.product_names)?a.product_names.join(", "):a.product_names||"",quantities:Array.isArray(a.quantities)?a.quantities.join(", "):a.quantities||"",prices:Array.isArray(a.prices)?a.prices.join(", "):a.prices||"",payment_type:a.payment_type||"",payment_amount:a.payment_amount||"",balance:a.balance||"",total:a.total||""}),I.get(`${A.apiUrl}/products`).then(d=>{const p=d.data.reduce((j,f)=>(j[f.name]=f.id,j),{});N(p)}).catch(d=>console.error("Error fetching product data:",d)))},[a]);const l=d=>{const{name:x,value:p}=d.target;g({...r,[x]:p})},v=()=>{const{product_names:d,quantities:x,prices:p,...j}=r,f=d?d.split(",").map(u=>P[u.trim()]||null):[],_=x?x.split(",").map(u=>u.trim()):[],w=p?p.split(",").map(u=>u.trim()):[],k={...j,...{pro_id:f,quantity:_,price:w}};I.put(`${A.apiUrl}/cust_purch/updateCustPurch/${a.cust_purch_id}`,k).then(u=>{D()}).catch(u=>{console.error("Error updating data. Please try again later.",u)})};return e.jsxs(b,{open:!0,onClose:D,maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{children:"Update Purchase"}),e.jsx(S,{children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Customer Name",name:"cust_name",value:r.cust_name,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Customer Mobile",name:"cust_mobile",value:r.cust_mobile,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Customer Email",name:"cust_email",value:r.cust_email,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Product Names (comma separated)",name:"product_names",value:r.product_names,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Quantities (comma separated)",name:"quantities",value:r.quantities,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Prices (comma separated)",name:"prices",value:r.prices,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Payment Type",name:"payment_type",value:r.payment_type,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Payment Amount",name:"payment_amount",value:r.payment_amount,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Balance",name:"balance",value:r.balance,onChange:l,variant:"outlined"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Total",name:"total",value:r.total,onChange:l,variant:"outlined"})})]})}),e.jsxs(M,{children:[e.jsx(h,{onClick:v,color:"primary",children:"Update"}),e.jsx(h,{onClick:D,color:"secondary",children:"Cancel"})]})]})},ke=()=>{const[a,D]=n.useState([]),[r,g]=n.useState([]),[P,N]=n.useState(5),[l,v]=n.useState(1),[d,x]=n.useState(!1),[p,j]=n.useState(!1),[f,_]=n.useState(!1),[w,U]=n.useState(!1),[k,u]=n.useState([]),[Q,R]=n.useState(),[E,G]=n.useState(null),[T,J]=n.useState(""),[F,K]=n.useState(""),[V,$]=n.useState(new Set);n.useEffect(()=>{I.get(`${A.apiUrl}/cust_purch/getCustPurchData/?emp_id=${sessionStorage.getItem("emp_id")}`).then(t=>{D(t.data),g(t.data);const s=new Set(t.data.filter(o=>o.deliveryed).map(o=>o.cust_purch_id));$(s)}).catch(t=>{console.log("Customer purchase data is not fetched.")})},[d,p,f]);const L=t=>{const s=a.find(o=>o.cust_purch_id===t);s&&(u(s),j(!0))},X=t=>{R(t),_(!0)},Y=()=>{I.delete(`${A.apiUrl}/cust_purch/deleteCustPurch/${Q}`).then(t=>{_(!1)}).catch(t=>{console.log("Error deleting data. Please try again later.")})},Z=t=>{const s=parseInt(t.target.value,10);s===1?(N(a.length),v(1)):(N(s),v(1))},ee=t=>{G(t),U(!0)},te=()=>{if(T&&F){const t=a.filter(s=>{const o=new Date(s.created_at);return o>=new Date(T)&&o<=new Date(F)});g(t),v(1)}else g(a)},O=(l-1)*P,ae=l*P,ne=r.slice(O,ae),se=t=>{I.post(`${A.apiUrl}/cust_purch/markAsDelivered/${t}`).then(s=>{console.log(s.data.message),$(o=>new Set(o.add(t)))}).catch(s=>{console.log("Error marking as delivered. Please try again later.")})};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-center",children:"Customer Purchase Index"}),e.jsxs(i,{container:!0,spacing:2,className:"mt-3",children:[e.jsx(i,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(h,{onClick:()=>x(!0),variant:"contained",children:"Purchase Product"})}),e.jsx(i,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(xe,{data:a,setData:g})}),e.jsx(i,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(ie,{children:e.jsxs(le,{value:P,onChange:Z,children:[e.jsx(q,{value:5,children:"5 Per Page"}),e.jsx(q,{value:10,children:"10 Per Page"}),e.jsx(q,{value:15,children:"15 Per Page"}),e.jsx(q,{value:1,children:"All Per Page"})]})})})]}),e.jsx(ge,{startDate:T,endDate:F,setStartDate:J,setEndDate:K,onFilter:te}),e.jsx(ce,{component:oe,className:"mt-4",children:e.jsxs(de,{children:[e.jsx(ue,{children:e.jsx(H,{children:["S.No","Customer Name","Customer Mobile","Customer Email","Product Name","Quantity","Price","Date/Time","Payment Type","Payment Amount","Balance","Total","Action"].map(t=>e.jsx(c,{style:{fontWeight:"bold",textAlign:"center"},children:t},t))})}),e.jsx(me,{children:ne.map((t,s)=>{const o=t.product_names?t.product_names.split(","):[],z=t.quantities?t.quantities.split(","):[],B=t.prices?t.prices.split(","):[];return e.jsxs(H,{children:[e.jsx(c,{align:"center",children:O+s+1}),e.jsx(c,{align:"center",children:t.cust_name}),e.jsx(c,{align:"center",children:t.cust_mobile}),e.jsx(c,{align:"center",children:t.cust_email}),e.jsx(c,{align:"center",children:o.length>0?o.map((y,C)=>e.jsx("div",{children:y},C)):"No products"}),e.jsx(c,{align:"center",children:z.length>0?z.map((y,C)=>e.jsx("div",{children:y},C)):"No quantities"}),e.jsx(c,{align:"center",children:B.length>0?B.map((y,C)=>e.jsx("div",{children:y},C)):"No prices"}),e.jsx(c,{children:(()=>{const y=ye(new Date(t.created_at),"dd/MM/yyyy HH:mm:ss"),[C,re]=y.split(" ");return e.jsxs(e.Fragment,{children:[C," ",e.jsx("span",{style:{color:"red"},children:re})]})})()}),e.jsx(c,{align:"center",children:t.payment_type}),e.jsx(c,{align:"center",children:t.payment_amount}),e.jsx(c,{align:"center",children:t.balance}),e.jsx(c,{align:"center",children:t.total}),e.jsxs(c,{align:"center",children:[e.jsx(h,{onClick:()=>L(t.cust_purch_id),variant:"contained",color:"primary",size:"small",style:{margin:"2px"},children:"Edit"}),e.jsx(h,{onClick:()=>X(t.cust_purch_id),variant:"contained",color:"secondary",size:"small",style:{margin:"2px"},children:"Delete"}),e.jsx(h,{onClick:()=>ee(t),variant:"contained",color:"success",size:"small",style:{margin:"2px"},children:"Invoice"}),!V.has(t.cust_purch_id)&&e.jsx(h,{onClick:()=>se(t.cust_purch_id),variant:"contained",color:"info",size:"small",style:{margin:"2px"},children:"Mark as Delivered"})]})]},t.cust_purch_id)})})]})}),e.jsx(he,{spacing:2,className:"mt-4",direction:"row",justifyContent:"center",children:e.jsx(fe,{count:Math.ceil(r.length/P),page:l,onChange:(t,s)=>v(s),color:"primary"})}),e.jsxs(b,{open:d,onClose:()=>x(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{children:"Purchase Product"}),e.jsx(S,{children:e.jsx(pe,{onClose:()=>x(!1)})})]}),e.jsxs(b,{open:p,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{children:"Update Purchase"}),e.jsx(S,{children:k&&e.jsx(Ce,{updateData:k,onClose:()=>j(!1)})})]}),e.jsxs(b,{open:f,onClose:()=>_(!1),children:[e.jsx(W,{children:"Confirm Deletion"}),e.jsx(S,{children:"Are you sure you want to delete this item?"}),e.jsxs(M,{children:[e.jsx(h,{onClick:Y,color:"primary",children:"Confirm"}),e.jsx(h,{onClick:()=>_(!1),color:"secondary",children:"Cancel"})]})]}),e.jsxs(b,{open:w,onClose:()=>U(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{children:"Purchase Invoice"}),e.jsx(S,{dividers:!0,children:E&&e.jsx(je,{data:E,dueDate:E.dueDate})}),e.jsx(M,{children:e.jsx(h,{onClick:()=>U(!1),color:"primary",children:"Close"})})]})]})};export{ke as default};
