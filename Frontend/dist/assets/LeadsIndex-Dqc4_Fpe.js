import{r as s,j as e,G as u,R as _,U as D,g as P,c as I,d as v,F as Q,V as B,z,E as G,H as q,J as K,K as L,N as a,Q as V,S as X}from"./index-CxJtQRLb.js";import{h as b}from"./moment-G82_0lEo.js";import{S as Z}from"./Search-BCnfRBZA.js";import{P as ee}from"./Pagination-CQtFweVv.js";import{D as te,a as se,b as ae}from"./DialogContent-DOuEahYY.js";import{D as ne}from"./DialogTitle-Cl70ZkoL.js";const re=({onFilterChange:S})=>{const[i,m]=s.useState([]),[E,f]=s.useState([]),[n,p]=s.useState(""),[g,h]=s.useState(""),[j,F]=s.useState(null),[C,R]=s.useState(null);s.useEffect(()=>{const r=sessionStorage.getItem("leadsData");if(r){const x=JSON.parse(r),Y=[...new Set(x.map(l=>l.SENDER_STATE))];m(Y)}},[]),s.useEffect(()=>{if(n){const r=sessionStorage.getItem("leadsData");if(r){const Y=JSON.parse(r).filter(l=>l.SENDER_STATE===n).map(l=>l.SENDER_CITY);f([...new Set(Y)])}}else f([])},[n]);const M=()=>{S&&S(n,g,j,C)};return e.jsx("div",{children:e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:6,children:e.jsx(_,{select:!0,fullWidth:!0,label:"Select State",value:n,onChange:r=>p(r.target.value),children:i.map((r,x)=>e.jsx(D,{value:r,children:r},x))})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(_,{select:!0,fullWidth:!0,label:"Select City",value:g,onChange:r=>h(r.target.value),disabled:!n,children:E.map((r,x)=>e.jsx(D,{value:r,children:r},x))})}),e.jsx(u,{item:!0,xs:12,display:"flex",justifyContent:"center",children:e.jsx(P,{variant:"contained",onClick:M,children:"Filter"})})]})})},le=S=>{const i=new Date(S),m=i.getDate().toString().padStart(2,"0"),E=(i.getMonth()+1).toString().padStart(2,"0"),f=i.getFullYear();let n=i.getHours();const p=i.getMinutes().toString().padStart(2,"0"),g=n>=12?"PM":"AM";n=n%12,n=n||12;const h=n.toString().padStart(2,"0");return`${m}/${E}/${f} ${h}:${p} ${g}`},fe=()=>{const S=b().subtract(1,"days").format("YYYY-MM-DD");b().format("YYYY-MM-DD");const[i,m]=s.useState([]),[E,f]=s.useState(!1),[n,p]=s.useState(""),[g,h]=s.useState([]),[j,F]=s.useState(5),[C,R]=s.useState(1),[M,r]=s.useState(b(`${S} 22:00:00`).format("YYYY-MM-DD HH:mm:ss")),[x,Y]=s.useState(b().format("YYYY-MM-DD HH:mm:ss")),[l,A]=s.useState(!1),[y,O]=s.useState(!1);s.useEffect(()=>{y&&W(M,x)},[M,x,y]),s.useEffect(()=>{if(!l){const t=sessionStorage.getItem("leadsData");t&&(m(JSON.parse(t)),h(JSON.parse(t)))}},[l]),s.useEffect(()=>{I.get(`${v.apiUrl}/leads/getFollowingLeadsMobile`).then(t=>{}).catch(t=>{console.log("Error Following Data Can't be fetched.")})},[]),s.useEffect(()=>{I.get(`${v.apiUrl}/customer/getCustomer`).then(t=>{}).catch(t=>{console.log("Error Customer Data Can't be fetched.")})},[]);const W=(t,o)=>{I.get(`${v.apiUrl}/leads/leadsData/?startTime=${t}&endTime=${o}`).then(c=>{c.data.data.RESPONSE.length>0&&(sessionStorage.setItem("leadsData",JSON.stringify(c.data.data.RESPONSE)),m(c.data.data.RESPONSE),h(c.data.data.RESPONSE))}).catch(c=>{var N,d;f(!0),p(((d=(N=c.response)==null?void 0:N.data)==null?void 0:d.message)||"An error occurred while fetching leads data"),console.error("Error:",c)})},$=(t,o,c,N)=>{let d=i;t&&(d=d.filter(T=>T.SENDER_STATE===t)),o&&(d=d.filter(T=>T.SENDER_CITY===o)),c&&N&&(d=d.filter(T=>b(T.CREATED_DATE).isBetween(c,N))),h(d)},U=()=>{A(!1),h(i)},k=t=>{const o=parseInt(t.target.value,10);o===1?(F(i.length),R(1)):(F(o),R(1))},w=(C-1)*j,H=C*j,J=g.slice(w,H);return e.jsxs("div",{children:[l&&!y&&e.jsx("h1",{className:"text-center",children:"Filtered Leads Index"}),!l&&y&&e.jsx("h1",{className:"text-center",children:"Today Leads"}),!l&&!y&&e.jsx("h1",{className:"text-center",children:"Leads Index"}),l?e.jsx(re,{onFilterChange:$}):null,e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(Z,{data:i,setData:h})}),e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:l?e.jsx(P,{onClick:U,variant:"contained",children:"Cancel Filter"}):e.jsxs(e.Fragment,{children:[e.jsx(P,{onClick:()=>A(!0),variant:"contained",children:"Apply Filter"}),e.jsx(P,{onClick:()=>O(!0),style:{marginLeft:"30px"},variant:"contained",children:"Today Leads"})]})}),e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(Q,{children:e.jsxs(B,{value:j,onChange:k,children:[e.jsx(D,{value:5,children:"5 Per Page"}),e.jsx(D,{value:10,children:"10 Per Page"}),e.jsx(D,{value:15,children:"15 Per Page"}),e.jsx(D,{value:1,children:"All Per Page"})]})})})]}),e.jsx(z,{component:G,className:"mt-3",children:e.jsxs(q,{children:[e.jsx(K,{children:e.jsxs(L,{style:{fontWeight:"bold",backgroundColor:"#FFF9C4"},children:[e.jsx(a,{style:{fontWeight:"bold"},children:"S.No"}),e.jsx(a,{style:{fontWeight:"bold"},children:"Date"}),e.jsx(a,{style:{fontWeight:"bold"},children:"Name"}),e.jsx(a,{style:{fontWeight:"bold"},children:"Mobile Number"}),e.jsx(a,{style:{fontWeight:"bold"},children:"Email"}),e.jsx(a,{style:{fontWeight:"bold"},children:"Company"}),e.jsx(a,{style:{fontWeight:"bold"},children:"Address"}),e.jsx(a,{style:{fontWeight:"bold"},children:"City"}),e.jsx(a,{style:{fontWeight:"bold"},children:"State"}),e.jsx(a,{style:{fontWeight:"bold"},children:"Product Name"})]})}),e.jsx(V,{children:J.map((t,o)=>e.jsxs(L,{children:[e.jsx(a,{children:o+1}),e.jsx(a,{children:le(t.QUERY_TIME)}),e.jsx(a,{children:t.SENDER_NAME}),e.jsx(a,{children:t.SENDER_MOBILE}),e.jsx(a,{children:t.SENDER_EMAIL}),e.jsx(a,{children:t.SENDER_COMPANY}),e.jsx(a,{children:t.SENDER_ADDRESS}),e.jsx(a,{children:t.SENDER_CITY}),e.jsx(a,{children:t.SENDER_STATE}),e.jsx(a,{children:t.QUERY_PRODUCT_NAME})]},t.UNIQUE_QUERY_ID))})]})}),e.jsx(u,{container:!0,spacing:2,display:"flex",justifyContent:"center",className:"mt-4",children:e.jsx(X,{spacing:2,children:e.jsx(ee,{count:Math.ceil(g.length/j),page:C,onChange:(t,o)=>R(o),size:"small",style:{cursor:"pointer"}})})}),e.jsxs(te,{open:E,onClose:()=>f(!1),children:[e.jsx(ne,{className:"text-center bg-danger",children:"ERROR"}),e.jsx(se,{className:"mt-3",children:e.jsx("p",{children:n})}),e.jsx(ae,{children:e.jsx(P,{onClick:()=>f(!1),children:"Close"})})]})]})};export{fe as default};
