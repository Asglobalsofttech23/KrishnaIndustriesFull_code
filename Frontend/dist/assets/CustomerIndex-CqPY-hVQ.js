import{r as o,j as e,G as u,R as f,g as m,c as v,d as T,F as te,V as se,U as P,z as re,E as ae,H as ne,J as le,K as N,N as s,Q as ce,S as oe}from"./index-CxJtQRLb.js";import{C as ie}from"./ConvertCustomer-B3busiYY.js";import{S as ue}from"./Search-BCnfRBZA.js";import{A as de}from"./AddCustPurch-FAcdwpbu.js";import{D as he}from"./DateFilter-3Dz2lqSw.js";import{P as me}from"./Pagination-CQtFweVv.js";import{D as k,a as E,b as W}from"./DialogContent-DOuEahYY.js";import{f as xe}from"./format-cwXK75ha.js";import"./moment-G82_0lEo.js";import"./Krishna Industries2-CaiO6x1k.js";const je=({data:n,onClose:j})=>{const[d,b]=o.useState({cust_name:n?n.cust_name:"",cust_mobile:n?n.cust_mobile:"",cust_email:n?n.cust_email:"",cust_company:n?n.cust_company:"",cust_address:n?n.cust_address:"",cust_state:n?n.cust_state:"",cust_city:n?n.cust_city:""}),[r,p]=o.useState({cust_name:"",cust_mobile:"",cust_email:"",cust_company:"",cust_address:"",cust_state:"",cust_city:""}),g=(x,l)=>{let a="";const c=l&&typeof l=="string"?l.trim():l;switch(x){case"cust_name":c||(a="Customer name is required.");break;case"cust_mobile":c||(a="Customer mobile is required.");break;case"cust_email":c||(a="Customer Email is required.");break;case"cust_company":c||(a="Customer Company is required.");break;case"cust_address":c||(a="Customer Address is required.");break;case"cust_state":c||(a="Customer State is required.");break;case"cust_city":c||(a="Customer City is required.");break}return a},h=x=>{const{name:l,value:a}=x.target,c=g(l,a);b({...d,[l]:a}),p({...r,[l]:c})},C=x=>{x.preventDefault();let l={};if(Object.keys(d).forEach(a=>{const c=d[a],y=g(a,c);y&&(l=y)}),Object.keys(l).length>0){p(l);return}v.put(`${T.apiUrl}/customer/update/${n.cust_id}`,d).then(a=>{j()}).catch(a=>{console.log("Error:",a)})};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-center",children:" Update Customer"}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:6,children:e.jsx(f,{fullWidth:!0,label:"Customer Name",name:"cust_name",onChange:h,value:d.cust_name,error:!!r.cust_name,helperText:r.cust_name})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(f,{fullWidth:!0,label:"Customer Mobile",name:"cust_mobile",onChange:h,value:d.cust_mobile,error:!!r.cust_mobile,helperText:r.cust_mobile})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(f,{fullWidth:!0,label:"Customer Email",name:"cust_email",onChange:h,value:d.cust_email,error:!!r.cust_email,helperText:r.cust_email})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(f,{fullWidth:!0,label:"Customer Company",name:"cust_company",onChange:h,value:d.cust_company,error:!!r.cust_company,helperText:r.cust_company})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(f,{fullWidth:!0,label:"Customer Address",name:"cust_address",onChange:h,value:d.cust_address,error:!!r.cust_address,helperText:r.cust_address})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(f,{fullWidth:!0,label:"Customer State",name:"cust_state",onChange:h,value:d.cust_state,error:!!r.cust_state,helperText:r.cust_state})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(f,{fullWidth:!0,label:"Customer City",name:"cust_city",onChange:h,value:d.cust_city,error:!!r.cust_city,helperText:r.cust_city})}),e.jsx(u,{item:!0,xs:12,display:"flex",justifyContent:"center",children:e.jsx(m,{onClick:C,variant:"contained",color:"primary",children:"Submit"})})]})]})},ke=()=>{const n=sessionStorage.getItem("emp_id"),[j,d]=o.useState([]),[b,r]=o.useState([]),[p,g]=o.useState(5),[h,C]=o.useState(1),[x,l]=o.useState(!1),[a,c]=o.useState(!1),[y,D]=o.useState(!1),[w,M]=o.useState([]),[O,F]=o.useState(),[A,S]=o.useState(!1),[q,$]=o.useState(),[U,H]=o.useState(""),[I,B]=o.useState("");o.useEffect(()=>{v.get(`${T.apiUrl}/customer/getCustomerByEmpId/${n}`).then(t=>{d(t.data),r(t.data)}).catch(t=>{console.log("Customer Data is not fetched.")})},[x,a,y]);const R=t=>{const i=j.find(_=>_.cust_id===t);i&&(M(i),c(!0))},V=t=>{F(t),D(!0)},z=()=>{v.delete(`${T.apiUrl}/customer/delete/${O}`).then(t=>{D(!1)}).catch(t=>{console.log("Error deleting data. Please try again later.")})},G=t=>{const i=parseInt(t.target.value,10);i===1?(g(j.length),C(1)):(g(i),C(1))},J=(h-1)*p,K=h*p,Q=b.slice(J,K),L=t=>{console.log("Clicked Purchase button for customer ID:",t),$(t),S(!0)},X=()=>{if(U&&I){const t=j.filter(i=>{const _=new Date(i.created_at);return _>=new Date(U)&&_<=new Date(I)});r(t),C(1)}else r(j)},Y=t=>{v.post(`${T.apiUrl}/sms/sendSms`,{to:t}).then(i=>{i.data.success?alert("SMS sent successfully!"):alert("Failed to send SMS.")}).catch(i=>{console.error("Error sending SMS:",i),alert("Error sending SMS.")})};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-center",children:"Customer Index"}),e.jsxs(u,{container:!0,spacing:2,className:"mt-3",children:[e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(m,{onClick:()=>l(!0),children:"Add New Customer"})}),e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(ue,{data:j,setData:r})}),e.jsx(u,{item:!0,xs:4,display:"flex",justifyContent:"center",children:e.jsx(te,{children:e.jsxs(se,{value:p,onChange:G,children:[e.jsx(P,{value:5,children:"5 Per Page"}),e.jsx(P,{value:10,children:"10 Per Page"}),e.jsx(P,{value:15,children:"15 Per Page"}),e.jsx(P,{value:1,children:"All Per Page"})]})})})]}),e.jsx(he,{startDate:U,endDate:I,setStartDate:H,setEndDate:B,onFilter:X}),e.jsx(re,{component:ae,className:"mt-3",children:e.jsxs(ne,{style:{borderCollapse:"collapse"},children:[e.jsx(le,{children:e.jsxs(N,{children:[e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"S.no"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"Employee Name"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"Customer Name"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"Mobile"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"Email"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"Company"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"Address"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"Date"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"State"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"City"}),e.jsx(s,{style:{fontWeight:"bold",color:"#003366"},children:"Action"})]})}),e.jsx(ce,{children:Q.map((t,i)=>e.jsxs(N,{children:[e.jsx(s,{children:i+1}),e.jsx(s,{children:t.emp_name}),e.jsx(s,{children:t.cust_name}),e.jsx(s,{children:t.cust_mobile}),e.jsx(s,{children:t.cust_email}),e.jsx(s,{children:t.cust_company}),e.jsx(s,{children:t.cust_address}),e.jsx(s,{children:(()=>{const _=xe(new Date(t.created_at),"dd/MM/yyyy HH:mm:ss"),[Z,ee]=_.split(" ");return e.jsxs(e.Fragment,{children:[Z," ",e.jsx("span",{style:{color:"red"},children:ee})]})})()}),e.jsx(s,{children:t.cust_state}),e.jsx(s,{children:t.cust_city}),e.jsxs(s,{children:[e.jsx(m,{onClick:()=>L(t.cust_id),children:"Purchase"}),e.jsx(m,{onClick:()=>R(t.cust_id),children:"Edit"}),e.jsx(m,{onClick:()=>V(t.cust_id),children:"Delete"}),e.jsx(m,{onClick:()=>Y(t.cust_mobile),children:"Send SMS"})]})]},t.cust_id))})]})}),e.jsx(u,{container:!0,spacing:2,display:"flex",justifyContent:"center",className:"mt-4",children:e.jsx(oe,{spacing:2,children:e.jsx(me,{count:Math.ceil(b.length/p),page:h,onChange:(t,i)=>C(i),size:"small",style:{cursor:"pointer","&:hover":{backgroundColor:"transparent"}}})})}),e.jsxs(k,{open:x,onClose:()=>l(!1),children:[e.jsx(E,{children:e.jsx(ie,{setOpen:l})}),e.jsx(W,{children:e.jsx(m,{onClick:()=>l(!1),children:"Cancel"})})]}),e.jsxs(k,{open:a,onClose:()=>c(!1),children:[e.jsx(E,{children:e.jsx(je,{setOpen:c,updateData:w})}),e.jsx(W,{children:e.jsx(m,{onClick:()=>c(!1),children:"Cancel"})})]}),e.jsxs(k,{open:y,onClose:()=>D(!1),children:[e.jsx(E,{children:e.jsx("h4",{children:"Do you really want to delete?"})}),e.jsxs(W,{children:[e.jsx(m,{onClick:()=>D(!1),children:"Cancel"}),e.jsx(m,{onClick:z,children:"Confirm"})]})]}),e.jsxs(k,{open:A,onClose:()=>S(!1),children:[e.jsx(E,{children:e.jsx(de,{setOpen:S,cust_id:q})}),e.jsx(W,{children:e.jsx(m,{onClick:()=>S(!1),children:"Cancel"})})]})]})};export{ke as default};
